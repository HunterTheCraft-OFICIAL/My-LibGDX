name: LibGDX ‚Äì Workflow 2 (Reorganiza Backends + Nativos)

on:
  workflow_run:
    workflows:
      - "LibGDX ‚Äì Build completo e artefato filtr√°vel"
    types:
      - completed

jobs:
  reorganize:
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Download do artefato do Workflow 1
      - name: Download artifact from Workflow 1
        uses: actions/download-artifact@v4
        with:
          path: input-artifact

      # 2Ô∏è‚É£ Ver estrutura recebida (debug)
      - name: Debug ‚Äì List received files
        run: |
          echo "üì¶ Conte√∫do recebido:"
          ls -R input-artifact

      # 3Ô∏è‚É£ Criar estrutura Android fake
      - name: Prepare Android fake structure
        run: |
          ROOT=output/android-fake
          mkdir -p $ROOT/{core,android}

          # Libs Java
          mkdir -p $ROOT/core/libs
          mkdir -p $ROOT/android/libs

          # Nativos Android
          mkdir -p $ROOT/android/jniLibs/{armeabi-v7a,arm64-v8a,x86,x86_64}

      # 4Ô∏è‚É£ Copiar JARs principais
      - name: Copy core and backend JARs
        run: |
          SRC=input-artifact
          ROOT=output/android-fake

          # Core
          cp $SRC/**/gdx*.jar $ROOT/core/libs/ || true

          # Android backend
          cp $SRC/**/backends/android/*.jar $ROOT/android/libs/ || true

          # Extens√µes
          cp $SRC/**/extensions/**/*.jar $ROOT/android/libs/ || true

      # 5Ô∏è‚É£ Copiar nativos Android (.so)
      - name: Copy Android native libraries
        run: |
          SRC=input-artifact
          JNI=output/android-fake/android/jniLibs

          find $SRC -type f -name "*.so" | while read so; do
            case "$so" in
              *armeabi-v7a*) cp "$so" "$JNI/armeabi-v7a/" ;;
              *arm64-v8a*)   cp "$so" "$JNI/arm64-v8a/" ;;
              *x86_64*)      cp "$so" "$JNI/x86_64/" ;;
              *x86*)         cp "$so" "$JNI/x86/" ;;
            esac
          done || true

      # 6Ô∏è‚É£ Debug final da estrutura
      - name: Debug ‚Äì Final structure
        run: |
          echo "üìÅ Estrutura final (Android fake):"
          ls -R output/android-fake

      # 7Ô∏è‚É£ Gerar ZIP confer√≠vel
      - name: Zip Android fake project
        run: |
          cd output
          zip -r android-fake-project.zip android-fake

      # 8Ô∏è‚É£ Upload do artefato
      - name: Upload Android fake artifact
        uses: actions/upload-artifact@v4
        with:
          name: android-fake-structure
          path: output/android-fake-project.zip