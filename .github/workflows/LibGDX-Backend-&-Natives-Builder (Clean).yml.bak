name: LibGDX Backend & Natives Builder (Refined)

on:
  workflow_dispatch:

env:
  LIBGDX_VERSION: 1.14.0

jobs:
  build-libgdx:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Java
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - name: Clone libGDX
        run: |
          git clone --branch $LIBGDX_VERSION https://github.com/libgdx/libgdx.git libgdx-src

      - name: Build libGDX
        working-directory: libgdx-src
        run: |
          ./gradlew \
            :gdx:build \
            :backends:gdx-backend-android:assembleRelease \
            :backends:gdx-backend-lwjgl3:build

      - name: Prepare artifact structure
        run: |
          mkdir -p libgdx-pronto/{core,desktop,android,natives/{windows,linux,macos}}

          # Core
          cp libgdx-src/gdx/build/libs/*.jar libgdx-pronto/core/

          # Desktop (LWJGL3)
          cp libgdx-src/backends/gdx-backend-lwjgl3/build/libs/*.jar libgdx-pronto/desktop/

          # Android
          cp libgdx-src/backends/gdx-backend-android/build/outputs/aar/*.aar libgdx-pronto/android/

          # Natives
          cp libgdx-src/backends/gdx-backend-lwjgl3/build/natives/*windows*.jar libgdx-pronto/natives/windows/ || true
          cp libgdx-src/backends/gdx-backend-lwjgl3/build/natives/*linux*.jar libgdx-pronto/natives/linux/ || true
          cp libgdx-src/backends/gdx-backend-lwjgl3/build/natives/*macos*.jar libgdx-pronto/natives/macos/ || true

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: libgdx-pronto-${{ env.LIBGDX_VERSION }}
          path: libgdx-pronto