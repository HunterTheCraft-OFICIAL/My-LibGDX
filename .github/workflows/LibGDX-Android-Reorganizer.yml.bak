name: LibGDX ‚Äì Workflow 2 (Reorganiza Backends + Nativos)

on:
  workflow_run:
    workflows:
      - "LibGDX ‚Äì Build completo e artefato filtr√°vel"
    types:
      - completed

jobs:
  reorganize:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest

    steps:
      # 1Ô∏è‚É£ Checkout (apenas para contexto)
      - name: Checkout repository
        uses: actions/checkout@v4

      # 2Ô∏è‚É£ Baixar artefato do Workflow 1
      - name: Download LibGDX artifact (Workflow 1)
        uses: actions/download-artifact@v4
        with:
          run-id: ${{ github.event.workflow_run.id }}
          path: input-artifact

      # 3Ô∏è‚É£ Debug ‚Äì listar conte√∫do recebido
      - name: üì¶ Conte√∫do recebido
        run: |
          echo "üìÇ Estrutura do artefato:"
          ls -R input-artifact

      # 4Ô∏è‚É£ Criar estrutura Android FAKE
      - name: Criar estrutura Android fake
        run: |
          mkdir -p output/android/libs
          mkdir -p output/android/src/jniLibs/{arm64-v8a,armeabi-v7a,x86_64,x86}
          mkdir -p output/android/extensions

      # 5Ô∏è‚É£ Copiar backend Android (.jar)
      - name: Copiar backend Android
        run: |
          find input-artifact -name "gdx-backend-android*.jar" -exec cp {} output/android/libs/ \;

      # 6Ô∏è‚É£ Copiar core libGDX
      - name: Copiar gdx core
        run: |
          find input-artifact -maxdepth 3 -name "gdx-*.jar" -exec cp {} output/android/libs/ \;

      # 7Ô∏è‚É£ Copiar nativos Android (.so)
      - name: Copiar nativos Android
        run: |
          ROOT=input-artifact

          find $ROOT -name "*natives-arm64-v8a.jar" -exec unzip -o {} "*.so" -d output/android/src/jniLibs/arm64-v8a \;
          find $ROOT -name "*natives-armeabi-v7a.jar" -exec unzip -o {} "*.so" -d output/android/src/jniLibs/armeabi-v7a \;
          find $ROOT -name "*natives-x86_64.jar" -exec unzip -o {} "*.so" -d output/android/src/jniLibs/x86_64 \;
          find $ROOT -name "*natives-x86.jar" -exec unzip -o {} "*.so" -d output/android/src/jniLibs/x86 \;

      # 8Ô∏è‚É£ Copiar extens√µes (Box2D, FreeType, etc)
      - name: Copiar extens√µes libGDX
        run: |
          if [ -d "input-artifact/libgdx/extensions" ]; then
            cp -r input-artifact/libgdx/extensions/* output/android/extensions/
          fi

      # 9Ô∏è‚É£ Debug ‚Äì estrutura final
      - name: üìÇ Estrutura Android fake final
        run: |
          ls -R output

      # üîü Upload artefato (Workflow 2)
      - name: Upload Android Fake Artifact
        uses: actions/upload-artifact@v4
        with:
          name: libgdx-android-fake
          path: output