name: LibGDX â€“ Workflow 2 (Reorganiza Backends + Nativos)

on:
  workflow_run:
    workflows:
      - "LibGDX â€“ Build completo e artefato filtrÃ¡vel"
    types:
      - completed

jobs:
  reorganize:
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest

    steps:
      - name: Checkout (contexto)
        uses: actions/checkout@v4

      # âœ… DOWNLOAD CORRETO DO ARTEFATO DO WF1
      - name: Download LibGDX artifact (Workflow 1)
        uses: actions/download-artifact@v4
        with:
          run-id: ${{ github.event.workflow_run.id }}
          name: libgdx-1.14.0
          path: input-artifact

      # ğŸ” DEBUG OBRIGATÃ“RIO
      - name: ğŸ“¦ Verificar artefato recebido
        run: |
          echo "ğŸ“‚ ConteÃºdo recebido:"
          ls -R input-artifact

      # ğŸ—ï¸ Estrutura Android fake
      - name: Criar estrutura Android fake
        run: |
          mkdir -p output/android/libs
          mkdir -p output/android/src/jniLibs/{arm64-v8a,armeabi-v7a,x86_64,x86}
          mkdir -p output/android/extensions

      # ğŸ“¦ Backend Android
      - name: Copiar backend Android
        run: |
          find input-artifact -name "gdx-backend-android*.jar" -exec cp {} output/android/libs/ \;

      # ğŸ“¦ Core libGDX
      - name: Copiar gdx core
        run: |
          find input-artifact -name "gdx-*.jar" -exec cp {} output/android/libs/ \;

      # ğŸ”‘ Nativos Android (.so)
      - name: Extrair nativos Android
        run: |
          find input-artifact -name "*natives-arm64-v8a.jar" -exec unzip -o {} "*.so" -d output/android/src/jniLibs/arm64-v8a \;
          find input-artifact -name "*natives-armeabi-v7a.jar" -exec unzip -o {} "*.so" -d output/android/src/jniLibs/armeabi-v7a \;
          find input-artifact -name "*natives-x86_64.jar" -exec unzip -o {} "*.so" -d output/android/src/jniLibs/x86_64 \;
          find input-artifact -name "*natives-x86.jar" -exec unzip -o {} "*.so" -d output/android/src/jniLibs/x86 \;

      # ğŸ§© ExtensÃµes
      - name: Copiar extensÃµes
        run: |
          if [ -d "input-artifact/libgdx/extensions" ]; then
            cp -r input-artifact/libgdx/extensions/* output/android/extensions/
          fi

      # ğŸ“‚ DEBUG FINAL
      - name: ğŸ“‚ Estrutura final
        run: |
          ls -R output

      # â¬†ï¸ Upload
      - name: Upload Android fake artifact
        uses: actions/upload-artifact@v4
        with:
          name: libgdx-android-fake
          path: output