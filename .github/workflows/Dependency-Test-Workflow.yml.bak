name: LibGDX Dependency Test Workflow

on:
  workflow_dispatch:   # s√≥ roda manualmente

jobs:
  test-build:
    runs-on: ubuntu-latest

    steps:
      # 0Ô∏è‚É£1Ô∏è‚É£ Checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # 0Ô∏è‚É£2Ô∏è‚É£ JDK compat√≠vel
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # 0Ô∏è‚É£3Ô∏è‚É£ Cache Gradle
      - name: Cache Gradle packages
        uses: actions/cache@v4
        with:
          path: ~/.gradle/caches
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

      # 0Ô∏è‚É£4Ô∏è‚É£ Permiss√£o gradlew
      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      # 0Ô∏è‚É£5Ô∏è‚É£ Diagn√≥stico de depend√™ncias (Android)
      - name: Show Android dependencies
        run: ./gradlew :android:dependencies --stacktrace

      # 0Ô∏è‚É£6Ô∏è‚É£ Listar jars baixados no cache
      - name: List Gradle cache jars
        run: ls -lh ~/.gradle/caches/modules-2/files-2.1/com.badlogicgames.gdx/gdx-backend-android/* || true

      # 0Ô∏è‚É£7Ô∏è‚É£ Rodar task de c√≥pia dos nativos
      - name: Run copyAndroidNatives
        run: ./gradlew :android:copyAndroidNatives --stacktrace

      # 0Ô∏è‚É£8Ô∏è‚É£ Rodar task de c√≥pia do backend jar (se existir)
      - name: Run copyBackendJar
        run: ./gradlew :android:copyBackendJar --stacktrace || true

      # üì¶ Snapshot completo do m√≥dulo Android
      - name: Upload Android module snapshot
        uses: actions/upload-artifact@v4
        with:
          name: Android-Module-Snapshot-Test
          path: android/
          retention-days: 7

      # 0Ô∏è‚É£9Ô∏è‚É£ Build completo (opcional)
      - name: Build all modules
        run: ./gradlew build --stacktrace