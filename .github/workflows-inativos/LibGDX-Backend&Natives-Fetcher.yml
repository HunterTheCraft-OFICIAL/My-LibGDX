name: LibGDX Backend & Natives Fetcher
# LibGDX-Backend&Natives-Fetcher

on:
  workflow_dispatch:

jobs:
  fetch-backends:
    runs-on: ubuntu-latest

    steps:
      # 0ï¸âƒ£ Checkout
      - name: Checkout repository
        uses: actions/checkout@v4

      # 1ï¸âƒ£ Configurar JDK 17
      - name: Set up JDK 17
        uses: actions/setup-java@v4
        with:
          java-version: '17'
          distribution: 'temurin'

      # 2ï¸âƒ£ Cache do Gradle
      - name: Cache Gradle packages
        uses: actions/cache@v4
        with:
          path: |
            ~/.gradle/caches
            ~/.gradle/wrapper
          key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
          restore-keys: |
            ${{ runner.os }}-gradle-

      # 3ï¸âƒ£ PermissÃ£o gradlew
      - name: Grant execute permission for gradlew
        run: chmod +x gradlew

      # 4ï¸âƒ£ Criar diretÃ³rios organizados
      - name: Create backend & natives directories
        run: |
          mkdir -p build/backend/android
          mkdir -p build/backend/desktop
          mkdir -p build/natives/android
          mkdir -p build/natives/desktop
          echo "âœ… DiretÃ³rios criados."

      # 5ï¸âƒ£ Resolver e baixar backends e nativos
      - name: Resolve backends & natives
        run: |
          set -e
          echo "ðŸ”Ž Resolving backends and natives..."

          BACKENDS_ANDROID=("gdx-backend-android")
          BACKENDS_DESKTOP=("gdx-backend-lwjgl")
          NATIVES_ANDROID=("natives-armeabi-v7a" "natives-arm64-v8a" "natives-x86" "natives-x86_64")
          NATIVES_DESKTOP=("natives-desktop")

          # Android backend
          for backend in "${BACKENDS_ANDROID[@]}"; do
            if ./gradlew ":android:dependencies" | grep -q "$backend"; then
              echo "âœ… $backend resolvido."
            else
              echo "âš ï¸ $backend NÃƒO encontrado!"
            fi
          done

          # Desktop backend
          for backend in "${BACKENDS_DESKTOP[@]}"; do
            if ./gradlew ":desktop:dependencies" | grep -q "$backend"; then
              echo "âœ… $backend resolvido."
            else
              echo "âš ï¸ $backend NÃƒO encontrado!"
            fi
          done

          # Android natives
          for native in "${NATIVES_ANDROID[@]}"; do
            if ./gradlew ":android:dependencies" | grep -q "$native"; then
              echo "âœ… $native resolvido."
            else
              echo "âš ï¸ $native NÃƒO encontrado!"
            fi
          done

          # Desktop natives
          for native in "${NATIVES_DESKTOP[@]}"; do
            if ./gradlew ":desktop:dependencies" | grep -q "$native"; then
              echo "âœ… $native resolvido."
            else
              echo "âš ï¸ $native NÃƒO encontrado!"
            fi
          done

      # 6ï¸âƒ£ SumÃ¡rio no painel
      - name: Summary of backend fetch
        run: |
          echo "## ðŸ”§ LibGDX Backends & Natives Fetch Summary" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Android Backends:" >> $GITHUB_STEP_SUMMARY
          for backend in "${BACKENDS_ANDROID[@]}"; do
            if ./gradlew ":android:dependencies" | grep -q "$backend"; then
              echo "- âœ… $backend" >> $GITHUB_STEP_SUMMARY
            else
              echo "- âš ï¸ $backend" >> $GITHUB_STEP_SUMMARY
            fi
          done
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Desktop Backends:" >> $GITHUB_STEP_SUMMARY
          for backend in "${BACKENDS_DESKTOP[@]}"; do
            if ./gradlew ":desktop:dependencies" | grep -q "$backend"; then
              echo "- âœ… $backend" >> $GITHUB_STEP_SUMMARY
            else
              echo "- âš ï¸ $backend" >> $GITHUB_STEP_SUMMARY
            fi
          done
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Android Natives:" >> $GITHUB_STEP_SUMMARY
          for native in "${NATIVES_ANDROID[@]}"; do
            if ./gradlew ":android:dependencies" | grep -q "$native"; then
              echo "- âœ… $native" >> $GITHUB_STEP_SUMMARY
            else
              echo "- âš ï¸ $native" >> $GITHUB_STEP_SUMMARY
            fi
          done
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### Desktop Natives:" >> $GITHUB_STEP_SUMMARY
          for native in "${NATIVES_DESKTOP[@]}"; do
            if ./gradlew ":desktop:dependencies" | grep -q "$native"; then
              echo "- âœ… $native" >> $GITHUB_STEP_SUMMARY
            else
              echo "- âš ï¸ $native" >> $GITHUB_STEP_SUMMARY
            fi
          done