plugins {
    id 'java'
}

repositories {
    mavenCentral()
    // Repositórios extras para snapshots e libs não publicadas no Maven Central
    maven { url "https://oss.sonatype.org/content/repositories/snapshots/" }
    maven { url "https://jitpack.io" }
}

dependencies {
    // Núcleo
    implementation "com.badlogicgames.gdx:gdx:1.12.0"

    // Backends multiplataforma
    implementation "com.badlogicgames.gdx:gdx-backend-lwjgl3:1.12.0"
    implementation "com.badlogicgames.gdx:gdx-backend-gwt:1.12.0"
    implementation "com.badlogicgames.gdx:gdx-backend-robovm:1.12.0"
    // ⚠️ Android backend não é resolvido como JAR, apenas AAR (para Android Studio)
    // implementation "com.badlogicgames.gdx:gdx-backend-android:1.12.0"

    // Nativos
    implementation "com.badlogicgames.gdx:gdx-platform:1.12.0:natives-desktop"
    implementation "com.badlogicgames.gdx:gdx-platform:1.12.0:natives-armeabi-v7a"
    implementation "com.badlogicgames.gdx:gdx-platform:1.12.0:natives-arm64-v8a"
    implementation "com.badlogicgames.gdx:gdx-platform:1.12.0:natives-x86"
    implementation "com.badlogicgames.gdx:gdx-platform:1.12.0:natives-x86_64"
    implementation "com.badlogicgames.gdx:gdx-platform:1.12.0:natives-ios"
    implementation "com.badlogicgames.gdx:gdx-platform:1.12.0:natives-gwt"

    // Extras
    implementation "com.badlogicgames.gdx:gdx-box2d:1.12.0"
    implementation "com.badlogicgames.gdx:gdx-freetype:1.12.0"
    implementation "com.badlogicgames.gdx:gdx-tools:1.12.0"
    implementation "com.badlogicgames.gdx:gdx-ai:1.8.2"
    implementation "com.badlogicgames.gdx:gdx-controllers:2.2.0-SNAPSHOT" // versão snapshot
    implementation "com.badlogicgames.gdx:gdx-bullet:1.12.0"

    // ⚠️ Internos/experimentais (não disponíveis no Maven Central)
    // implementation "com.badlogicgames.gdx:gdx-video:1.12.0"
    // implementation "com.badlogicgames.gdx:gdx-jnigen:1.12.0"
    // implementation "com.badlogicgames.gdx:gdx-setup:1.12.0"
    // implementation "com.badlogicgames.gdx:gdx-tests:1.12.0"
}

// Task 1: Checar se dependências existem
task checkDependencies {
    doLast {
        def reportFile = file("$buildDir/check-report.txt")
        reportFile.text = "=== RELATÓRIO DE CHECAGEM ===\n\n"
        def found = 0
        configurations.runtimeClasspath.resolvedConfiguration.resolvedArtifacts.each { artifact ->
            if (artifact.file.exists()) {
                reportFile << "✅ Encontrada: ${artifact.name} (${artifact.moduleVersion.id.version})\n"
                found++
            } else {
                reportFile << "⚠️ Não encontrada: ${artifact.name} (${artifact.moduleVersion.id.version})\n"
            }
        }
        if (found == 0) {
            throw new GradleException("❌ Nenhuma dependência encontrada online!")
        }
    }
}

// Task 2: Baixar dependências (pula falhas)
task downloadDependencies {
    doLast {
        def reportFile = file("$buildDir/download-report.txt")
        reportFile.text = "=== RELATÓRIO DE DOWNLOAD ===\n\n"
        def success = 0
        configurations.runtimeClasspath.resolvedConfiguration.resolvedArtifacts.each { artifact ->
            try {
                if (artifact.file.exists()) {
                    copy {
                        from artifact.file
                        into "$buildDir/all-libs"
                    }
                    reportFile << "✅ Sucesso: ${artifact.name} (${artifact.moduleVersion.id.version})\n"
                    success++
                } else {
                    reportFile << "⚠️ Não encontrada: ${artifact.name} (${artifact.moduleVersion.id.version})\n"
                }
            } catch(Exception e) {
                reportFile << "❌ Falha no download: ${artifact.name} (${artifact.moduleVersion.id.version})\nErro: ${e.message}\n"
            }
        }
        if (success == 0) {
            reportFile << "\n❌ Nenhuma dependência foi baixada com sucesso.\n"
        }
    }
}

// Task 3: Relatório geral consolidado
task generateReport {
    dependsOn checkDependencies, downloadDependencies
    doLast {
        def reportFile = file("$buildDir/libs-report.txt")
        reportFile.text = "=== RELATÓRIO CONSOLIDADO ===\n\n"
        def checkReport = file("$buildDir/check-report.txt")
        def downloadReport = file("$buildDir/download-report.txt")

        if (checkReport.exists()) {
            reportFile << checkReport.text + "\n"
        }
        if (downloadReport.exists()) {
            reportFile << downloadReport.text + "\n"
        }
    }
}